<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <f:metadata>
        <f:viewAction action="#{fastFoodBean.init()}"/>
    </f:metadata>
    <h:head>
        <title>FastFood</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="shortcut icon" href="resources/imagens/mesa.png" type="image/x-icon" />
        <meta name="mobile-web-app-capable" content="yes" />
        <h:outputStylesheet library="css" name="bootstrap.css" />
        <h:outputStylesheet library="css" name="fast.css" />
        <h:outputScript library="primefaces" name="jquery.js"/>
        <script src="resources/js/bootstrap.min.js"></script>
        <script>
            window.onload = function () {
                limitarCaracteres();
            };
            function limitarCaracteres() {
                var nomeProdutos = document.querySelectorAll(".nome-produto");
                nomeProdutos.forEach(e => {
                    var texto = e.textContent;
                    if (texto.toString().length >= 21)
                        e.textContent = texto.toString().substring(0, 20);
                });
            }
            function adicionarQuantidade(id, idInput) {
                var valor = parseInt(document.getElementById(id).textContent);
                valor += 1;
                if (tratarNumerosNegativos(valor))
                    document.getElementById(id).textContent = valor;
                document.getElementById(idInput).value = valor;
            }
            function removerQuantidade(id, idInput) {
                var valor = parseInt(document.getElementById(id).textContent);
                valor -= 1;
                if (tratarNumerosNegativos(valor)) {
                    document.getElementById(id).textContent = valor;
                    document.getElementById(idInput).value = valor;
                }
            }
            function mandarFocu() {
                var botoes = document.querySelectorAll(".focu");
                botoes.forEach(b => {
                    b.focus();
                });
            }
            function tratarNumerosNegativos(valor) {
                //<![CDATA[ 
                if (valor < 1)
                    return false;
                return true;
                //]]> 
            }
        </script>
    </h:head>
    <h:body>
        <h:form id="frm">
            <div class="container-fluid">
                <div class="row">
                    <div class="row campo-pesquisa">
                        <h:inputText class="form-control" style="font-size: 15pt; color: #858585 !important;"
                                     value="#{fastFoodBean.pesquisa}" onkeyup="this.value = this.value.toUpperCase();">
                            <f:passThroughAttribute name="placeholder" value="Pesquisa"/>
                            <f:passThroughAttribute name="autofocus" value="true"/>
                            <f:ajax event="keyup" render="frm:produto" execute="@this" listener="#{fastFoodBean.pesquisarProduto()}"
                                    onevent="limitarCaracteres"/>
                        </h:inputText>
                    </div>
                    <div class="col-xs-2 barra-grupo">
                        <ul jsf:id="listaGrupo">
                            <ui:repeat id="prd" value="#{fastFoodBean.grupos}" var="g" varStatus="indexpdr">
                                <li jsf:id="item">                                    
                                    <p:graphicImage id="img" library="imagens" name="drink.png" width="35" class="li-grupo"/> 
                                    <p:outputPanel id="grupo">
                                        #{g.t51dsgrp}
                                    </p:outputPanel>
                                    <f:ajax event="click" render="frm:produto" execute="@this" listener="#{fastFoodBean.pesquisarPorGrupo(g)}" onevent="limitarCaracteres"/>
                                </li>                                 
                            </ui:repeat>   
                        </ul>          
                    </div>
                    <div class="col-xs-7" style="overflow: auto; height: 350px;">
                        <h:panelGroup id="produto">
                            <ui:repeat id="loop" value="#{fastFoodBean.produtos}" var="produto" varStatus="status">
                                <div class="col-xs-2 produto">
                                    <h:panelGroup id="adicaoProduto" style="cursor: pointer;">
                                        <div class="row text-center">
                                            <div class="col-xs-12 text-center">
                                                <span class="nome-produto" style="font-size: 8pt;">#{produto.descricao}</span>
                                            </div>
                                        </div>
                                        <f:ajax event="click" render="frm:itens" execute="@this frm:loop:#{status.index}:qtdInput" listener="#{fastFoodBean.adicionarItem(produto)}" 
                                                onevent="mandarFocu"/>
                                        <div class="row text-center" style="font-size: 6pt;">
                                            <h:outputText value="#{produto.preco}">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </div>
                                    </h:panelGroup>  
                                    <div class="row" style="margin-top: 15px;">
                                        <div class="col-xs-4 text-left">
                                            <span class="btn btn-danger fa fa-minus"
                                                  onclick="removerQuantidade('frm:loop:#{status.index}:qtd', 'frm:loop:#{status.index}:qtdInput')"></span>
                                        </div>
                                        <div class="col-xs-3 text-center" style="font-size: 12pt;">
                                            <h:outputText id="qtd" value="1" />
                                            <h:inputText id="qtdInput" value="#{fastFoodBean.quantidade}" style="display: none;"/>
                                        </div>
                                        <div class="col-xs-4 text-right" >
                                            <span class="btn btn-success fa fa-plus" onclick="adicionarQuantidade('frm:loop:#{status.index}:qtd', 'frm:loop:#{status.index}:qtdInput');"></span>
                                        </div>
                                    </div>
                                </div>
                            </ui:repeat>
                        </h:panelGroup>  
                    </div>
                    <div class="col-xs-3 lista-itens" style="overflow: auto; height: 350px;">
                        <h:panelGroup id="itens">
                            <h:outputText value="Nenhum registro adicionado." rendered="#{empty fastFoodBean.lancamentos}"/>
                            <table class="table table-hover">
                                <tbody>
                                    <ui:repeat id="itensAdicionados" value="#{fastFoodBean.lancamentos}" var="lacamento">
                                        <tr style="background: #f0fef0;">
                                            <td>
                                                <div class="row referencia" >
                                                    <div class="col-xs-5">Ref #{lacamento.referencia}</div>
                                                    <div class="col-xs-3 text-center">Qt #{lacamento.quantidade}</div>
                                                    <div class="col-xs-4 text-right">Val #{lacamento.preco}</div>  
                                                </div>
                                                <div class="row item">
                                                    <div class="col-xs-9">#{lacamento.descricao}</div>
                                                    <div class="col-xs-2">
                                                        <h:outputText value="#{lacamento.precoTotal}">
                                                            <f:convertNumber pattern="###,##0.00"/>
                                                        </h:outputText>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <h:commandLink id="apagar" class="btn btn-danger" style="color: #bbb;font-size:11pt;" actionListener="#{fastFoodBean.removerItem(lacamento)}">
                                                    <i class="fa fa-trash"></i>
                                                    <f:ajax render="frm:itens" execute="@this" />
                                                </h:commandLink>
                                                <button style="background: #fff;outline: none;border: none;" class="focu"></button>
                                            </td>
                                        </tr>
                                    </ui:repeat>  
                                </tbody>
                            </table>
                        </h:panelGroup> 
                    </div>
                </div>
            </div>

            <div class="container-fluid barra-botoes" >
                <div class="row " >
                    <div class="col-xs-9" >
                        <div class="row " >
                            <div class="col-xs-12">
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary" 
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia01)}">
                                        #{fastFoodBean.atalhoFastFood.descricao01}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia02)}"
                                                   >
                                        #{fastFoodBean.atalhoFastFood.descricao02}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia03)}">
                                        #{fastFoodBean.atalhoFastFood.descricao03}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia04)}">
                                        #{fastFoodBean.atalhoFastFood.descricao04}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia05)}">
                                        #{fastFoodBean.atalhoFastFood.descricao05}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia06)}">
                                        #{fastFoodBean.atalhoFastFood.descricao06}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia07)}">
                                        #{fastFoodBean.atalhoFastFood.descricao07}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia08)}">
                                        #{fastFoodBean.atalhoFastFood.descricao08}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary" 
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia09)}">
                                        #{fastFoodBean.atalhoFastFood.descricao09}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia10)}">
                                        #{fastFoodBean.atalhoFastFood.descricao10}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia11)}">
                                        #{fastFoodBean.atalhoFastFood.descricao11}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                                <div class="col-xs-3">
                                    <h:commandLink class="btn btn-block btn-primary"
                                                   actionListener="#{fastFoodBean.buscarProduto(fastFoodBean.atalhoFastFood.referencia12)}">
                                        #{fastFoodBean.atalhoFastFood.descricao12}
                                        <f:ajax execute="@this" render="frm:itens" onevent="mandarFocu"/>
                                    </h:commandLink>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-3" >
                        <p:commandLink class="btn btn-block btn-warning" style="padding-top: 20px;font-size: 25pt;height: 110px;"
                                       actionListener="#{fastFoodBean.finalizar()}"
                                       process="@this" oncomplete="PF('dialogFinalizar').hide();">
                            Finalizar
                        </p:commandLink>
                    </div>
                </div>
            </div>
        </h:form>
        <p:dialog id="dlFinalizar" widgetVar="dialogFinalizar" header="Finalizar" draggable="false" dynamic="true" responsive="true" resizable="false"
                  modal="true" showEffect="fade" position="center">
            <h:form id="frmFinalizar">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <h:outputLabel value="Comanda"/>
                            <h:inputText class="form-control" required="true"
                                         requiredMessage="Comanda obrigatoria!"
                                         onkeyup="apenasNumeros(this)"
                                         value="#{fastFoodBean.comandas.COMANDA}">
                                <f:passThroughAttribute name="placeholder" value="Número da comanda."/>
                            </h:inputText>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="ui-g-12 ui-md-4">
                                <div class="ui-inputgroup">
                                    <span class="btn btn-danger fa fa-minus"
                                          onclick="removerQuantidade('frmFinalizar:labelPessoas', 'frmFinalizar:pessoas');"/> 
                                    <h:outputText id="labelPessoas" value="1" style="font-size: 13pt;"/>
                                    <p:inputText id="pessoas" placeholder="Pessoas" value="#{fastFoodBean.comandas.PESSOAS}" 
                                                 style="display: none;"/>
                                    <span class="btn btn-success fa fa-plus"
                                          onclick="adicionarQuantidade('frmFinalizar:labelPessoas', 'frmFinalizar:pessoas');"/>     
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p:commandLink class="btn btn-success btn-block"
                                           actionListener="#{fastFoodBean.finalizar()}">
                                <i class="fa fa-check"></i>
                                Confirma
                            </p:commandLink>
                        </div>
                    </div>
                </div>
            </h:form>
            <script>
                function apenasNumeros(input) {
                    var regExp = /[^0-9]/g;
                    input.value = input.value.replace(regExp, "");
                    input.value = ("0000" + input.value).slice(-4);
                }
            </script>
        </p:dialog>
        <p:dialog id="dlQuantidade" widgetVar="dialogQuantidade" header="Definir Quantidade" draggable="false" dynamic="true" responsive="true" resizable="false"
                  modal="true" showEffect="fade" position="center">
            <p:ajax event="close" process="@this" listener="#{fastFoodBean.novoProduto()}" />
            <h:form>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <h:outputLabel value="Quantidade"/>
                            <h:inputText class="form-control" value="#{fastFoodBean.quantidade}"
                                         onkeyup="this.value = this.value.replace(/[^0,-9,]/g, '');"
                                         converter="converterValor">
                                <f:passThroughAttribute name="placeholder" value="Quantidade"/>
                                <f:passThroughAttribute name="autofocus" value="true"/>
                                <f:passThroughAttribute name="type" value="tel"/>
                            </h:inputText>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p:commandLink oncomplete="PF('dialogQuantidade').hide();"
                                           process="@form" update="@form frm:itens"
                                           actionListener="#{fastFoodBean.definirQuantidade()}">
                                <i class="fa fa-check"></i>
                                Quantidade
                            </p:commandLink>
                        </div>
                    </div>
                </div>
                <p:commandButton id="default" style="display: none;"/>
                <p:defaultCommand target="default"/>
            </h:form>
        </p:dialog>
        <!--FORMULARIO DE AUTORIZAÇÃO-->
        <p:dialog header="Autorização" resizable="false" modal="true" responsive="true" fitViewport="true" draggable="false" width="300" id="dlUsuario" widgetVar="dialogoUsuario" dynamic="true" 
                  closable="false" closeOnEscape="true"
                  showEffect="fade" hideEffect="fade">
            <h:form id="frmDialogo"> 
                <p:messages id="msgUsuario" closable="true" showIcon="false"/>
                <div class="ui-fluid">                    
                    <p:panelGrid id="panelUsuario" columns="1" layout="grid" styleClass="ui-panelgrid-blank">
                        <p:focus for="usuario"/>
                        <p:outputLabel for="usuario" value="Usuario" class="modal-text"/>
                        <p:inputText id="usuario"  label="usuario" required="true" requiredMessage="Nome do Usuario devi ser informado" maxlength="15" style="text-transform: uppercase;"/>
                        <p:outputLabel for="senha" value="Senha" class="modal-text"/>
                        <p:password id="senha" required="true" requiredMessage="Senha do Usuario devi ser informado" maxlength="10" />
                    </p:panelGrid>
                </div>
                <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank">
                    <p:commandLink id="sim" class="btn-modal btn btn-success btn-block" value="Confirma" oncomplete="handleLoginRequest(xhr, status, args);" resetValues="true"/>
                    <a id="nao" class="btn-modal btn btn-danger btn-block" onclick="PF('dialogoUsuario').hide();">
                        Cancelar
                    </a>
                </p:panelGrid>
                <p:defaultCommand target="sim" />
            </h:form>
            <script type="text/javascript">
                function handleLoginRequest(xhr, status, args) {
                    if (args.fechar) {
                        PF('dialogoUsuario').hide();
                    }
                }
            </script>
        </p:dialog>
        <!--MODAL DE ENVIO PARA IMPRESSÃO-->
        <p:dialog  styleClass="mensagem-impressao" resizable="false" focus="voltar" modal="true" responsive="true" fitViewport="true" draggable="false" width="100%"  id="dlImpressao" widgetVar="dialogoImpressao" dynamic="true" 
                   closable="false" closeOnEscape="true"
                   showEffect="fade" hideEffect="fade" visible="false">
            <span style="font-size: 15pt;">#{produtoBean.mensagem}</span>
            <p:commandLink id="voltar" oncomplete="PF('dialogoImpressao').hide();" process="@this" update="frm:itens" class="btn-modal btn btn-warning btn-block"  style="margin-top: 30px; color: #fff;">OK</p:commandLink>
        </p:dialog>
    </h:body>
</html>

